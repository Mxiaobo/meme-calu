<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Meme 50-25-25 Calculator</title>

<!-- 保险：所有 hidden 都彻底隐藏 -->
<style>.hidden{display:none!important}</style>

<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* ---------- 颜色 ---------- */
:root{
  --bg:#f7f7fa;--card:#fff;--border:#e4e6eb;--text:#1f2328;
  --accent:#2563eb;--share:#3b82f6;
}
@media(prefers-color-scheme:dark){
  :root{
    --bg:#0e0f11;--card:#1e1f23;--border:#2b2d33;--text:#e8e9ea;
    --accent:#3b82f6;--share:#60a5fa;
  }
}

/* ---------- 基本排版 ---------- */
*{box-sizing:border-box;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1.2rem}

/* ---------- 卡片 ---------- */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;
      padding:1.6rem;max-width:440px;width:100%;box-shadow:0 4px 12px rgba(0,0,0,.15)}
h1{margin:0 0 1.25rem;text-align:center;font-weight:700;font-size:1.35rem}

/* ---------- 表单 ---------- */
label{display:flex;flex-direction:column;font-size:.9rem;margin-top:1.1rem}
input{margin-top:.4rem;padding:.6rem .8rem;font-size:1rem;border:1px solid var(--border);
      border-radius:8px;background:transparent;color:var(--text)}

/* ---------- 按钮 ---------- */
button{margin-top:1.1rem;width:100%;padding:.8rem 1rem;font-size:1rem;font-weight:600;
       border:none;border-radius:8px;color:#fff;cursor:pointer;transition:.15s}
#go{background:var(--accent)}
#go:hover{filter:brightness(1.05)}
#shareBtn{background:var(--share)}
#shareBtn:hover{filter:brightness(1.08)}

/* ---------- 结果表 ---------- */
table{width:100%;border-collapse:collapse;margin-top:1.6rem;font-size:.9rem}
th,td{padding:.55rem;border:1px solid var(--border)}
th{background:rgba(0,0,0,.05)}
tfoot td{font-weight:600;background:rgba(0,0,0,.03)}
</style>
</head>
<body>
<main class="card" id="card">
  <h1>Meme 50-25-25 Calculator</h1>

  <label>Current Price (USDT)
    <input type="number" id="price" value="2" step="0.0001" min="0">
  </label>

  <label>Total Allocation (USDT)
    <input type="number" id="alloc" value="10000" step="1" min="0">
  </label>

  <button id="go">Calculate</button>
  <button id="shareBtn" class="hidden">Share Result</button>

  <table id="out" class="hidden">
    <thead><tr><th>Stage</th><th>Invest</th><th>Price</th><th>Units</th></tr></thead>
    <tbody id="rows"></tbody>
    <tfoot>
      <tr><td>Total Units</td><td id="tCost"></td><td></td><td id="tUnits"></td></tr>
      <tr><td>Avg Cost</td><td colspan="3" id="avg"></td></tr>
      <tr><td>Stop (p3×0.8)</td><td colspan="3" id="stop"></td></tr>
      <tr><td>TP1 (+100%,50%)</td><td colspan="3" id="tp1"></td></tr>
      <tr><td>TP2 (+300%,25%)</td><td colspan="3" id="tp2"></td></tr>
    </tfoot>
  </table>
</main>

<script>
/* ---- SW 注册 ---- */
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js')}

/* ---- 便捷函数 ---- */
const $ = id => document.getElementById(id)
const fmt = (n,d=4)=>(+n).toFixed(d).replace(/\.?0+$/,'') // 去掉多余 0

/* ---- 计算按钮 ---- */
$('go').addEventListener('click',()=>{
  const P=parseFloat($('price').value),A=parseFloat($('alloc').value)
  if(!P||!A){alert('Enter valid numbers');return}

  const p1=P,p2=P*0.5,p3=P*0.25
  const i1=A*0.5,i2=A*0.25,i3=A*0.25
  const u1=i1/p1,u2=i2/p2,u3=i3/p3
  const units=u1+u2+u3,avg=A/units
  const stop=p3*0.8,tp1=avg*2,tp2=avg*4

  $('rows').innerHTML=[['Init 50%',i1,p1,u1],['-50% 25%',i2,p2,u2],['-75% 25%',i3,p3,u3]]
    .map(r=>`<tr><td>${r[0]}</td><td>${fmt(r[1],2)}</td><td>${fmt(r[2])}</td><td>${fmt(r[3],2)}</td></tr>`).join('')
  $('out').classList.remove('hidden')
  $('tCost').textContent=fmt(A,2);$('tUnits').textContent=fmt(units,2)
  $('avg').textContent=fmt(avg);$('stop').textContent=fmt(stop)
  $('tp1').textContent=fmt(tp1);$('tp2').textContent=fmt(tp2)

  /* 让分享按钮现身 */
  $('shareBtn').classList.remove('hidden')
})

/* ---- Share 按钮 ---- */
$('shareBtn').addEventListener('click',async()=>{
  const canvas = await html2canvas($('card'),{scale:3,backgroundColor:null})
  const blob   = await new Promise(r=>canvas.toBlob(r,'image/png'))
  const file   = new File([blob],'meme_calc.png',{type:'image/png'})

  if(navigator.canShare && navigator.canShare({files:[file]})){
    await navigator.share({files:[file],title:'Meme 50-25-25 Result'})
  }else{
    const link=document.createElement('a')
    link.href=URL.createObjectURL(blob)
    link.download='meme_calc.png'
    link.click()
    URL.revokeObjectURL(link.href)
    alert('Image downloaded!')
  }
})
</script>
</body></html>
